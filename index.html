<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>German Spelling City</title>
<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  background: #f4f6f8;
  margin: 0;
  padding: 0;
}

.container {
  max-width: 600px;
  margin: 40px auto;
  background: white;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

h1 {
  text-align: center;
  margin-bottom: 10px;
}

textarea, input {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  font-size: 16px;
}

button {
  width: 100%;
  padding: 12px;
  margin-top: 15px;
  font-size: 16px;
  background: #2563eb;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

button:hover {
  background: #1e40af;
}

.hidden {
  display: none;
}

.feedback {
  margin-top: 10px;
  font-weight: bold;
}

.correct {
  color: green;
}

.incorrect {
  color: red;
}

.word-counter {
  text-align: center;
  margin-top: 10px;
  color: #555;
}
</style>
</head>

<body>

<div class="container">

<h1>ğŸ‡©ğŸ‡ª German Spelling City</h1>

<div id="setup">
  <p>Pega tus palabras (una por lÃ­nea):</p>
  <textarea id="wordList" rows="8" placeholder="das Haus
der Freund
die Schule"></textarea>
  <button onclick="startTest()">Empezar dictado</button>
</div>

<div id="test" class="hidden">
  <button onclick="playAudio()">ğŸ”Š Escuchar palabra</button>
  <input id="answer" placeholder="Escribe aquÃ­â€¦" autofocus />
  <button onclick="checkAnswer()">Confirmar</button>
  <div id="feedback" class="feedback"></div>
  <div class="word-counter" id="counter"></div>
</div>

<div id="end" class="hidden">
  <h2>ğŸ‰ SesiÃ³n terminada</h2>
  <p>Solo quedaron las palabras difÃ­ciles.</p>
  <button onclick="restart()">Practicar errores</button>
</div>

</div>

<script>
let words = [];
let errors = [];
let currentWord = "";
let index = 0;

function startTest() {
  const input = document.getElementById("wordList").value.trim();
  if (!input) return;

  words = input.split("\n").map(w => w.trim());
  errors = [];
  index = 0;

  document.getElementById("setup").classList.add("hidden");
  document.getElementById("test").classList.remove("hidden");

  nextWord();
}

function playAudio() {
  const utterance = new SpeechSynthesisUtterance(currentWord);
  utterance.lang = "de-DE";
  speechSynthesis.speak(utterance);
}

function nextWord() {
  if (index >= words.length) {
    endSession();
    return;
  }
  currentWord = words[index];
  document.getElementById("answer").value = "";
  document.getElementById("feedback").textContent = "";
  document.getElementById("counter").textContent =
    `Palabra ${index + 1} de ${words.length}`;
  playAudio();
}

function checkAnswer() {
  const userInput = document.getElementById("answer").value.trim();
  const feedback = document.getElementById("feedback");

  if (userInput === currentWord) {
    feedback.textContent = "âœ” Correcto";
    feedback.className = "feedback correct";
  } else {
    feedback.textContent = `âœ˜ Incorrecto â€” ${currentWord}`;
    feedback.className = "feedback incorrect";
    errors.push(currentWord);
  }

  index++;
  setTimeout(nextWord, 1000);
}

function endSession() {
  document.getElementById("test").classList.add("hidden");

  if (errors.length > 0) {
    words = [...errors];
    errors = [];
    index = 0;
    document.getElementById("end").classList.remove("hidden");
  } else {
    document.getElementById("end").innerHTML =
      "<h2>ğŸ† Perfecto</h2><p>No hay errores ğŸ‰</p>";
    document.getElementById("end").classList.remove("hidden");
  }
}

function restart() {
  document.getElementById("end").classList.add("hidden");
  document.getElementById("test").classList.remove("hidden");
  nextWord();
}
</script>

</body>
</html>
